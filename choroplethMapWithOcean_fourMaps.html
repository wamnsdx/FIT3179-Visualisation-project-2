<!DOCTYPE html>
<html>
<head>
  <title>Global Data Visualisation Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.18.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.8"></script>
  <!-- ✅ Add Pure.css for grid layout -->
  <link rel="stylesheet" href="https://unpkg.com/purecss@2.1.0/build/pure-min.css">

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background-color: #f8f9fa;
    }
    h1 {
      margin-bottom: 10px;
    }
    p.description {
      max-width: 900px;
      margin: 0 auto 30px auto;
      font-size: 16px;
      line-height: 1.6;
      color: #333;
    }
    .chart {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      background: white;
      padding: 20px;
      border-radius: 10px;
    }
    .side-text {
      text-align: left;
      max-width: 90%;
      font-size: 15px;
      line-height: 1.6;
      color: #333;
      background: #ffffff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin: 0 auto;
    }
    /* === Layout Grid Adjustments === */
    .pure-g {
      align-items: flex-start;
      margin-bottom: 60px;
    }
    .pure-g.center {
      justify-content: center;
    }
    .pure-g.space-between {
      justify-content: space-between;
    }
  </style>
</head>

<body>
  <h1>Global Data Visualisation Dashboard</h1>

  <!-- 📝 Intro description -->
  <p class="description">
    Weather is closely related to our lives. The weather in a country is very likely to affect whether a country is livable, thereby affecting the country’s population and the country’s average life expectancy.
    This visualisation aims to visualise the weather data and the population, average life expectancy using maps mainly, and try to find out the potential impact of the weather in a particular country.
  </p>

  <!-- 🌡️ First map + side text -->
  <div class="pure-g center">
    <div class="pure-u-1 pure-u-md-1-2">
      <div id="map_temp" class="chart"></div>
    </div>
    <div class="pure-u-1 pure-u-md-1-2">
      <div class="side-text">
        <b>About Global Temperature Patterns:</b><br><br>
        Generally speaking, related to latitude, temperatures on Earth generally increase as latitude decreases. However, based on the Earth's atmospheric circulation patterns, countries closer to the equator tend to experience more precipitation, and there is a subtropical high-pressure belt near 30 degrees north and south latitude, so countries near 30 degrees north and south latitude will experience more extreme high temperatures, which would potentially make their average temperature higher.
      </div>
    </div>
  </div>

  <!-- 🌧️ Average Annual Rainfall Map -->
  <div class="pure-g">
    <div class="pure-u-1">
      <div id="map_rainfall" class="chart"></div>
    </div>
    <div class="pure-u-1 pure-u-md-1-2">
        <div class="side-text">
          <b>About Global Rainfall Patterns:</b><br><br>
          The distribution of precipitation is more complex than average annual temperature. 
          It is influenced not only by latitude but also by the relative position of land and sea, 
          monsoon circulation systems, and ocean currents. Globally, the driest regions are primarily 
          located in Central and North Africa, while the wettest regions are located in Southeast Asian 
          countries such as Malaysia and Indonesia.
          </div>
    </div>
  </div>


  <!-- 👥 Population map -->
  <div class="pure-g center">
    <div class="pure-u-1">
      <div id="map_pop" class="chart"></div>
    </div>
  </div>

  <!-- 📝 Description under Population Map -->
  <div class="pure-g center">
    <div class="pure-u-1">
      <div class="side-text">
        <b>About Global Population Patterns:</b><br><br>
        It seems that many countries has a very similar population with each other, 
        except China and India, which have a much higher population.
      </div>
    </div>
  </div>

  <!-- 💚 Life Expectancy Map + Bar Chart -->
<div class="pure-g" style="display: flex; justify-content: center; align-items: flex-start; gap: 40px; margin-bottom: 60px;">
    <div class="pure-u-1 pure-u-md-1-2" style="flex: 1; text-align: left;">
      <div id="map_life" class="chart" style="width: 100%; max-width: 700px;"></div>
    </div>
    <div class="pure-u-1 pure-u-md-1-2" style="flex: 0 0 450px; text-align: right;">
      <div id="bar_life" class="chart" style="width: 100%;"></div>
    </div>
  </div>

  <!-- 📝 Description of Conclusion -->
  <div class="pure-g center">
    <div class="pure-u-1">
      <div class="side-text">
        <b>Conclusion based on the whole visualisation:</b><br><br>
        Based on the comparison between the weather-related data and the population & average life expectancy, 
        we can make conclude that there is no clear relationship between the temperature/rainfall and the population of a particular country. 
        However, if a country tends to be drier and hotter, the average life expectancy tends to be lower. 
      </div>
    </div>
  </div>

  <script>
    // === MAP 1: Average Temperature ===
    const mapTemperature = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Average Temperature of Each Country (2024)",
      "width": 800,
      "height": 400,
      "params": [{
        "name": "temp_filter",
        "value": -10,
        "bind": {"input": "range","min": -10,"max": 30,"step": 1,"name": "Min temperature filter: "}
      }],
      "projection": {"type": "equalEarth"},
      "layer": [
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
                  "format": {"type": "topojson","feature": "oceans"}},
         "mark": {"type": "geoshape","fill": "skyblue"}},
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/WorldMapWithGraticules.topojson",
                  "format": {"type": "topojson","feature": "ne_110m_graticules_30"}},
         "mark": {"type": "geoshape","fill": null,"stroke": "lightgray"}},
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
                  "format": {"type": "topojson","feature": "ne_110m_admin_0_countries"}},
         "transform": [
           {"lookup": "properties.NAME",
            "from": {"data": {"url": "https://raw.githubusercontent.com/wamnsdx/FIT3179-Visualisation-project-2/main/data/covid_10_10_2020.csv"},
                     "key": "Country","fields": ["Active"]}},
           {"calculate": "datum.Active","as": "Average temperature in 2024"},
           {"filter": "datum['Average temperature in 2024'] >= temp_filter"}
         ],
         "mark": {"type": "geoshape","stroke": "white"},
         "encoding": {
           "color": {"field": "Average temperature in 2024","type": "quantitative",
                     "scale": {"type": "threshold","domain": [0,5,10,15,20,25],
                               "range": ["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"]}},
           "tooltip": [
             {"field": "properties.NAME","type": "nominal","title": "Country"},
             {"field": "Average temperature in 2024","type": "quantitative","format": ".1f"}
           ]
         }}
      ]
    };

    // === MAP 1B: Average Annual Rainfall ===
    const mapRainfall = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Average Annual Rainfall of Each Country (2024)",
      "width": 800,
      "height": 400,
      "projection": {"type": "equalEarth"},
      "layer": [
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
                  "format": {"type": "topojson","feature": "oceans"}},
         "mark": {"type": "geoshape","fill": "skyblue"}},
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/WorldMapWithGraticules.topojson",
                  "format": {"type": "topojson","feature": "ne_110m_graticules_30"}},
         "mark": {"type": "geoshape","fill": null,"stroke": "lightgray"}},
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
                  "format": {"type": "topojson","feature": "ne_110m_admin_0_countries"}},
         "transform": [{"lookup": "properties.NAME",
                        "from": {"data": {"url": "data/covid_10_10_2020.csv"},
                                 "key": "Country",
                                 "fields": ["Average annual rainfall"]}}],
         "mark": {"type": "geoshape","stroke": "white"},
         "encoding": {
           "color": {"field": "Average annual rainfall","type": "quantitative","title": "Rainfall (mm)",
                     "scale": {"type": "threshold","domain": [250,500,750,1000,2000,3000],
                               "range": ["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"]}},
           "tooltip": [{"field": "properties.NAME","type": "nominal","title": "Country"},
                       {"field": "Average annual rainfall","type": "quantitative","format": ".1f"}]
         }}
      ]
    };

    // === MAP 2: Population (💜 purple scheme) ===
    const mapPopulation = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Population of Each Country (2024)",
      "width": 800,
      "height": 400,
      "projection": {"type": "equalEarth"},
      "layer": [
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
                  "format": {"type": "topojson","feature": "oceans"}},
         "mark": {"type": "geoshape","fill": "skyblue"}},
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/WorldMapWithGraticules.topojson",
                  "format": {"type": "topojson","feature": "ne_110m_graticules_30"}},
         "mark": {"type": "geoshape","fill": null,"stroke": "lightgray"}},
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
                  "format": {"type": "topojson","feature": "ne_110m_admin_0_countries"}},
         "transform": [{"lookup": "properties.NAME",
                        "from": {"data": {"url": "https://raw.githubusercontent.com/wamnsdx/FIT3179-Visualisation-project-2/main/data/covid_10_10_2020.csv"},
                                 "key": "Country","fields": ["Population"]}}],
         "mark": {"type": "geoshape","stroke": "white"},
         "encoding": {"color": {"field": "Population","type": "quantitative","scale": {"scheme": "purples"},"title": "Population"},
                      "tooltip": [{"field": "properties.NAME","type": "nominal","title": "Country"},
                                  {"field": "Population","type": "quantitative","format": ","}]}}
      ]
    };

    // === MAP 3: Life Expectancy ===
    const mapLifeExpectancy = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Average Life Expectancy of Each Country (2024)",
      "width": 700,
      "height": 400,
      "projection": {"type": "equalEarth"},
      "layer": [
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
                  "format": {"type": "topojson","feature": "oceans"}},
         "mark": {"type": "geoshape","fill": "skyblue"}},
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/WorldMapWithGraticules.topojson",
                  "format": {"type": "topojson","feature": "ne_110m_graticules_30"}},
         "mark": {"type": "geoshape","fill": null,"stroke": "lightgray"}},
        {"data": {"url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
                  "format": {"type": "topojson","feature": "ne_110m_admin_0_countries"}},
         "transform": [{"lookup": "properties.NAME",
                        "from": {"data": {"url": "data/covid_10_10_2020.csv"},
                                 "key": "Country","fields": ["Average life expectancy"]}}],
         "mark": {"type": "geoshape","stroke": "white"},
         "encoding": {"color": {"field": "Average life expectancy","type": "quantitative",
                                "scale": {"type": "threshold","domain": [50,55,60,65,70,75,80,85],
                                          "range": ["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529","#002d19"]}},
                      "tooltip": [{"field": "properties.NAME","type": "nominal","title": "Country"},
                                  {"field": "Average life expectancy","type": "quantitative","format": ".1f"}]}}
      ]
    };

    // === BAR CHART: Top 5 Life Expectancy ===
    const barLifeExpectancy = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Top 8 Countries by Average Life Expectancy",
      "width": 250,
      "height": 400,
      "data": {"url": "https://raw.githubusercontent.com/wamnsdx/FIT3179-Visualisation-project-2/main/data/covid_10_10_2020.csv"},
      "transform": [
        {"filter": "datum['Average life expectancy'] != null"},
        {"window": [{"op": "rank","as": "rank"}], "sort": [{"field": "Average life expectancy","order": "descending"}]},
        {"filter": "datum.rank <= 5"}
      ],
      "mark": "bar",
      "encoding": {
        "x": {"field": "Country","type": "nominal","sort": "-y","title": "Country"},
        "y": {"field": "Average life expectancy","type": "quantitative","title": "Average Life Expectancy"},
        "color": {"field": "Average life expectancy","type": "quantitative","scale": {"scheme": "greens"}},
        "tooltip": [{"field": "Country","type": "nominal"},
                    {"field": "Average life expectancy","type": "quantitative","format": ".1f"}]
      }
    };

    // === EMBED ALL VISUALISATIONS ===
    vegaEmbed("#map_temp", mapTemperature);
    vegaEmbed("#map_rainfall", mapRainfall);
    vegaEmbed("#map_pop", mapPopulation);
    vegaEmbed("#map_life", mapLifeExpectancy);
    vegaEmbed("#bar_life", barLifeExpectancy);
  </script>
</body>
</html>
